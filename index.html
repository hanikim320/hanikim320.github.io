<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>잠재적 편견 테스트 · 도덕 수업 (30문항)</title>
  <meta name="description" content="중학교 도덕 수업용 성찰형 편견 테스트">
  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --ink:#111827; --muted:#6b7280; --line:#e5e7eb;
      --accent:#111827; --accent-weak:#11182712; --good:#10b981; --warn:#f59e0b; --bad:#ef4444;
      --brand1:#6366f1; --brand2:#22c55e;
      --radius:18px; --shadow:0 4px 16px rgba(17,24,39,.06);
    }
    *{box-sizing:border-box}
    body{margin:0; background:var(--bg); color:var(--ink); font: 16px/1.55 system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Noto Sans KR, "Helvetica Neue", Arial, "PingFang SC", "Hiragino Sans", sans-serif;}
    header.hero{position:sticky; top:0; z-index:10; background:linear-gradient(180deg,#fff,rgba(255,255,255,.9)); backdrop-filter:saturate(1.2) blur(6px); border-bottom:1px solid var(--line);}
    .wrap{max-width:1100px; margin:0 auto; padding:20px}
    .brand{display:flex; align-items:center; gap:.8rem}
    .logo{width:36px; height:36px; display:grid; place-items:center; border-radius:12px; background:linear-gradient(135deg,var(--brand1),var(--brand2)); color:#fff; font-weight:700}
    .toolbar{display:flex; align-items:center; gap:.5rem; margin-left:auto}
    .btn{border:1px solid var(--line); background:#fff; padding:8px 12px; border-radius:12px; cursor:pointer}
    .btn[disabled]{opacity:.5; cursor:not-allowed}
    main{padding:22px 0 40px}
    .grid{display:grid; gap:14px; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));}
    .card{background:var(--card); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px}
    .muted{color:var(--muted)}
    .progress{height:10px; border-radius:999px; background:#e9e9ef; overflow:hidden}
    .progress > span{display:block; height:100%; background:var(--accent);}
    .badge{display:inline-flex; align-items:center; gap:.45rem; padding:.35rem .6rem; border:1px solid var(--line); border-radius:999px; font-size:.9rem}
    .pill{display:inline-flex; align-items:center; gap:.35rem; padding:.2rem .5rem; border:1px solid var(--line); border-radius:999px; color:var(--muted); font-size:.8rem}
    .qgrid{display:grid; gap:10px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));}
    .opt{display:flex; align-items:center; gap:.55rem; border:1px solid var(--line); border-radius:12px; padding:.65rem .75rem; cursor:pointer; background:#fff; transition:.15s}
    .opt:hover{background:#fafafa}
    .opt.active{border-color:var(--accent); background:var(--accent-weak)}
    .qtitle{display:flex; gap:.5rem; align-items:center; justify-content:space-between}
    .chart{display:grid; gap:10px}
    .bar{display:grid; grid-template-columns: 140px 1fr; align-items:center; gap:10px}
    .barlabel{white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .bartrack{height:12px; background:#eef0f5; border-radius:999px; overflow:hidden; border:1px solid var(--line)}
    .barfill{height:100%; background:linear-gradient(90deg,var(--brand1),var(--brand2))}
    .pair{display:flex; align-items:center; justify-content:space-between}
    .actions{display:flex; gap:8px; align-items:center}
    footer{color:var(--muted); border-top:1px solid var(--line); background:#fff}
    .hint{background:#fff7ed; border:1px solid #fed7aa; color:#b45309; padding:8px 10px; border-radius:10px; font-size:.9rem}
    @media print{ header, .btn{display:none !important} body{background:#fff} .card{box-shadow:none} }
  </style>
</head>
<body>
  <header class="hero">
    <div class="wrap" style="display:flex; align-items:center; gap:12px;">
      <div class="brand">
        <div class="logo">도</div>
        <div>
          <div style="font-weight:800;">잠재적 편견 테스트</div>
          <div class="muted" style="font-size:.9rem;">중학교 도덕 · 확장형 30문항</div>
        </div>
      </div>
      <div class="toolbar">
        <button class="btn" id="printBtn" disabled title="모든 문항 응답 후 인쇄 가능">인쇄</button>
        <button class="btn" id="resetBtn">초기화</button>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <section class="grid">
        <article class="card">
          <div style="font-weight:700; margin-bottom:6px;">검사의 목적</div>
          <div class="muted">정답/오답을 가르는 진단이 아니라, 무심코 드러나는 편견을 <b>자각→성찰→행동</b>으로 잇는 성찰형 활동입니다.</div>
          <div style="margin-top:12px;">
            <div class="pair">
              <small class="muted">진행률 <span id="progLabel">0%</span></small>
              <small class="muted"><span id="countLabel">0</span>/30 응답</small>
            </div>
            <div class="progress" aria-hidden="true"><span id="progBar" style="width:0%"></span></div>
            <div id="scoreSlot" style="margin-top:8px" class="muted">모든 문항 응답 후 결과가 공개됩니다.</div>
            <div class="actions" style="margin-top:8px;">
              <button class="btn" id="revealBtn">결과 보기</button>
              <span class="muted" id="revealHint"></span>
            </div>
          </div>
        </article>

        <article class="card">
          <div style="font-weight:700; margin-bottom:6px;">영역별 점수(%)</div>
          <div id="chartSlot" class="muted" style="min-height:220px; display:flex; align-items:center; justify-content:center;">모든 문항을 응답하면 그래프가 나타납니다.</div>
          <small class="muted">* 각 영역 최대점수 15점(3문항×5점) → 백분율로 표시</small>
        </article>
      </section>

      <section id="qMount" style="margin-top:16px"></section>

      <section id="summaryMount" style="margin-top:16px"></section>
    </div>
  </main>

  <footer>
    <div class="wrap" style="padding:18px 20px;">© 2025 도덕 수업용 잠재적 편견 테스트 · 교실 내 배포/수정 자유</div>
  </footer>

  <script>
    const QUESTIONS = [
      { id: 1, text: "나는 외모나 옷차림이 깔끔하지 않은 사람을 보면 신뢰가 덜 간다.", domain: "외모 편견" },
      { id: 2, text: "피부나 체형이 사회 기준과 다르면 관리가 부족하다고 느낀다.", domain: "외모 편견" },
      { id: 3, text: "첫인상이 좋지 않으면 그 사람의 성격도 별로일 것 같다.", domain: "외모 편견" },
      { id: 4, text: "특정 지역 사람들은 성격이 급하거나 거칠다고 생각한다.", domain: "출신 지역 편견" },
      { id: 5, text: "내가 사는 지역이 다른 지역보다 더 살기 좋다고 느낀다.", domain: "출신 지역 편견" },
      { id: 6, text: "방언을 쓰는 사람을 보면 촌스럽다고 느낀 적이 있다.", domain: "출신 지역 편견" },
      { id: 7, text: "육체노동은 공부를 덜 한 사람들이 하는 일이라고 생각한다.", domain: "직업 편견" },
      { id: 8, text: "유명 직업을 가진 사람은 인격적으로도 뛰어날 것이라 생각한다.", domain: "직업 편견" },
      { id: 9, text: "알바나 단순 노동을 하는 사람에게 무의식적으로 반말을 한 적이 있다.", domain: "직업 편견" },
      { id: 10, text: "남자는 여자보다 감정 표현을 덜 해야 한다고 생각한다.", domain: "성별 편견" },
      { id: 11, text: "여자는 남자보다 감성적이고, 리더십에는 약하다고 느낀다.", domain: "성별 편견" },
      { id: 12, text: "집안일은 여자 쪽이 더 잘해야 한다고 생각한 적이 있다.", domain: "성별 편견" },
      { id: 13, text: "식사할 때 손으로 밥을 먹는 것은 위생적이지 않다고 느낀다.", domain: "문화 편견" },
      { id: 14, text: "내 나라 문화가 다른 나라 문화보다 예의 바르다고 생각한다.", domain: "문화 편견" },
      { id: 15, text: "낯선 복장이나 종교적 의상을 보면 어색하거나 불편하다.", domain: "문화 편견" },
      { id: 16, text: "피부색이 어두운 사람을 보면 본능적으로 경계심이 든다.", domain: "인종 편견" },
      { id: 17, text: "백인이나 서양인은 더 세련되었다는 생각이 든 적이 있다.", domain: "인종 편견" },
      { id: 18, text: "다른 인종의 사람과 짝을 이루면 살짝 부담스럽다.", domain: "인종 편견" },
      { id: 19, text: "나와 다른 종교를 믿는 사람의 신앙 방식이 이상하게 느껴진다.", domain: "종교 편견" },
      { id: 20, text: "종교가 있는 사람은 비이성적일 것 같다고 생각한다.", domain: "종교 편견" },
      { id: 21, text: "특정 종교의 상징물(십자가, 히잡 등)을 보면 불편하게 느껴진다.", domain: "종교 편견" },
      { id: 22, text: "장애가 있는 친구와 함께 활동하면 불편할 것 같다.", domain: "장애 편견" },
      { id: 23, text: "장애가 있으면 대부분 도움을 받아야만 한다고 생각한다.", domain: "장애 편견" },
      { id: 24, text: "장애 학생이 수업 참여 시 방해될까 걱정한 적이 있다.", domain: "장애 편견" },
      { id: 25, text: "경제적으로 어려운 사람은 노력하지 않아서 그런 것이라고 생각한다.", domain: "경제 편견" },
      { id: 26, text: "브랜드 옷을 입은 사람은 부유하고 성취한 사람 같다고 느낀다.", domain: "경제 편견" },
      { id: 27, text: "가난한 사람을 보면 불쌍하지만 어느 정도는 자기 탓이라 생각한다.", domain: "경제 편견" },
      { id: 28, text: "나와 비슷한 배경을 가진 사람과 있을 때 가장 편안하다.", domain: "내집단 중심성" },
      { id: 29, text: "새로운 친구보다는 기존 친구들과 어울리는 게 더 좋다.", domain: "내집단 중심성" },
      { id: 30, text: "나와 생각이 너무 다른 사람과 대화하면 피곤하다.", domain: "내집단 중심성" }
    ];
    const LIKERT = [
      { value: 1, label: "① 전혀 그렇지 않다" },
      { value: 2, label: "② 그렇지 않다" },
      { value: 3, label: "③ 보통이다" },
      { value: 4, label: "④ 그렇다" },
      { value: 5, label: "⑤ 매우 그렇다" }
    ];
    const SUGGEST = {
      "외모 편견": "외형 대신 구체적 행동 근거로 칭찬하기(하루 1회).",
      "출신 지역 편견": "지역 고정관념을 데이터/사례로 반박해보기.",
      "직업 편견": "직업=임금이 아니라 '사회적 기여' 관점으로 보기.",
      "성별 편견": "감정 어휘 5개를 오늘 대화에서 사용해보기.",
      "문화 편견": "낯선 예절의 맥락을 찾아 장점 1개 기록하기.",
      "인종 편견": "낯섦을 호기심 질문 1개로 바꾸기.",
      "종교 편견": "서로 다른 종교의 공통 가치 1개 적기.",
      "장애 편견": "'불편'→'무엇이 필요할까?'로 전환, 합리적 배려 체크.",
      "경제 편견": "빈곤의 구조적 요인/정책 1개 조사하기.",
      "내집단 중심성": "의도적으로 낯선 짝과 인터뷰 후 공통점 3가지 찾기."
    };

    const KEY = "bias-answers-ultra-v1";
    let answers = {};
    try { answers = JSON.parse(localStorage.getItem(KEY)) || {}; } catch(e){ answers = {}; }
    function save(){ try { localStorage.setItem(KEY, JSON.stringify(answers)); } catch(e){} }

    function el(tag, attrs={}, children=[]){
      const x = document.createElement(tag);
      for (const [k,v] of Object.entries(attrs)){
        if (k === "class") x.className = v;
        else if (k === "html") x.innerHTML = v;
        else if (k.startsWith("on") && typeof v === "function") x.addEventListener(k.substring(2), v);
        else x.setAttribute(k, v);
      }
      (Array.isArray(children)?children:[children]).forEach(c=>{ if (c!=null) x.appendChild(typeof c==="string"?document.createTextNode(c):c); });
      return x;
    }

    function render(){
      const answered = Object.keys(answers).length;
      const pct = Math.round(answered/QUESTIONS.length*100);
      document.getElementById("progLabel").textContent = pct + "%";
      document.getElementById("countLabel").textContent = answered;
      document.getElementById("progBar").style.width = pct + "%";

      const allDone = answered === QUESTIONS.length;
      document.getElementById("printBtn").disabled = !allDone;

      const scoreSlot = document.getElementById("scoreSlot");
      if (allDone){
        const total = QUESTIONS.reduce((s,q)=> s + (answers[q.id] || 0), 0);
        const max = QUESTIONS.length*5;
        const ratio = Math.round(total/max*100);
        let tier = "열린 마음형", color = "var(--good)";
        if (ratio >= 60){ tier="잠재적 편견 주의형"; color="var(--bad)"; }
        else if (ratio >= 35){ tier="성찰 중간형"; color="var(--warn)"; }
        scoreSlot.innerHTML = `<span class="badge" style="border-color:${color}; color:${color}">${tier}<span class="muted">(${total}/${max}, ${ratio}%)</span></span>`;
      } else {
        scoreSlot.textContent = "모든 문항 응답 후 결과가 공개됩니다.";
      }

      const chartSlot = document.getElementById("chartSlot");
      const summaryMount = document.getElementById("summaryMount");
      chartSlot.innerHTML = ""; summaryMount.innerHTML = "";
      if (!allDone){
        chartSlot.textContent = "모든 문항을 응답하면 그래프가 나타납니다.";
        const hold = el("article", {class:"card muted"}, "결과는 모든 문항에 응답한 뒤 확인할 수 있습니다.");
        summaryMount.appendChild(hold);
      } else {
        const map = new Map();
        for (const q of QUESTIONS){
          const prev = map.get(q.domain) || { sum:0, cnt:0 };
          map.set(q.domain, { sum: prev.sum + (answers[q.id] || 0), cnt: prev.cnt + 1 });
        }
        const data = Array.from(map.entries()).map(([domain, {sum,cnt}])=>{
          const max = cnt*5, pct = Math.round(sum/max*100), avg = +(sum/cnt).toFixed(1);
          return { domain, sum, cnt, max, pct, avg };
        }).sort((a,b)=>b.pct-a.pct);

        const chart = el("div", {class:"chart"});
        data.forEach(d=>{
          const bar = el("div", {class:"bar"}, [
            el("div", {class:"barlabel"}, d.domain),
            el("div", {class:"bartrack"}, el("div", {class:"barfill", style:`width:${d.pct}%;`}))
          ]);
          chart.appendChild(bar);
        });
        chartSlot.appendChild(chart);

        const sumWrap = el("section", {class:"grid"});
        const left = el("article",{class:"card"}, [
          el("div",{style:"font-weight:700; margin-bottom:6px;"}, "영역별 요약"),
          el("div",{}, data.map(d=> el("div",{class:"pair"},[ el("span",{}, d.domain), el("small",{class:"muted"}, `${d.sum}/${d.max}점 (${d.pct}%) · 평균 ${d.avg}`) ])))
        ]);
        const right = el("article",{class:"card"}, [
          el("div",{style:"font-weight:700; margin-bottom:6px;"}, "바로 실천할 작은 행동"),
          el("ul",{}, data.slice(0,3).map(d=> el("li",{}, `• ${d.domain}: ${SUGGEST[d.domain]||""}`))),
          el("small",{class:"muted"}, "* 상위 3개 영역을 기준으로 자동 제안됩니다.")
        ]);
        sumWrap.append(left); sumWrap.append(right);
        summaryMount.appendChild(sumWrap);
      }
    }

    function mountQuestions(){
      const mount = document.getElementById("qMount");
      mount.innerHTML = "";
      const grid = el("div",{class:"grid"}); mount.appendChild(grid);
      QUESTIONS.forEach(q=>{
        const card = el("article",{class:"card"});
        const head = el("div",{class:"qtitle"},[
          el("div",{}, `${q.id}. ${q.text}`),
          el("span",{class:"pill"}, q.domain)
        ]);
        const opts = el("div",{class:"qgrid"});
        LIKERT.forEach(opt=>{
          const lab = el("label",{class:"opt"+(answers[q.id]===opt.value?" active":""), for:`q${q.id}_${opt.value}`});
          const input = el("input", {type:"radio", name:`q${q.id}`, id:`q${q.id}_${opt.value}`, value:String(opt.value)});
          input.checked = answers[q.id]===opt.value;
          input.addEventListener("change", ()=>{ answers[q.id]=opt.value; save(); render(); mountQuestions(); });
          lab.appendChild(input); lab.appendChild(el("span",{}, opt.label));
          opts.appendChild(lab);
        });
        card.appendChild(head); card.appendChild(opts); grid.appendChild(card);
      });
    }

    document.getElementById("printBtn").addEventListener("click", ()=> window.print());
    document.getElementById("resetBtn").addEventListener("click", ()=>{
      if (confirm("모든 응답을 초기화할까요?")){
        answers={}; save(); render(); mountQuestions(); window.scrollTo({top:0, behavior:"smooth"});
      }
    });
    document.getElementById("revealBtn").addEventListener("click", ()=>{
      const first = QUESTIONS.find(q=> !answers[q.id]);
      if (first){
        document.getElementById(`q${first.id}_1`).scrollIntoView({behavior:"smooth", block:"center"});
        document.getElementById("revealHint").textContent = "미응답 문항부터 선택해 주세요.";
        setTimeout(()=> document.getElementById("revealHint").textContent="", 4000);
      } else {
        document.getElementById("revealHint").textContent = "";
      }
    });

    mountQuestions(); render();
  </script>
</body>
</html>
